<!DOCTYPE html> 
<html>
<head>
	<meta charset="UTF-8" />
  <link rel="stylesheet" type="text/css" media="screen" href="/components/00_general.css" />
  <script type="text/javascript" src="/wasabi/wasabi.js"></script>
  <link rel="stylesheet" type="text/css" media="screen" href="/wasabi/wasabi.css" />
  <title>Wasabi Tree</title>
  <script>
    window.onload = function() {
      var dataset   = [];
      var url_vars  = getUrlVars();
      var url       = url_vars['url'];
      var rest_url  = url_vars['rest_url'];
      var tree      = url_vars['tree'];
      var alignment = url_vars['alignment'];

      if (rest_url) {
        dataset.push(rest_url);
        initTree(dataset);
      }
      else if (tree || alignment) {
        tree && dataset.push(tree);
        alignment && dataset.push(alignment);
        initTree(dataset);
      }
      else if (url) {
        $.get(url, function(data) {
          var path = JSON.parse(data);
          path.tree && dataset.push(path.tree);
          path.alignment && dataset.push(path.alignment);
          initTree(dataset);
        });
      }
    }

    function initTree(dataset) {
      if (dataset) {
        var options = {
            'allanim': false, 
            'colorScheme': 'Zappo',
            'translate': 'codons',
            'sharelinks': true
        };
        var w = new Wasabi(dataset.length > 1 ? dataset : dataset[0], '#wasabi_ensembl', options);
      }
      else {
        $('#wasabi_ensembl').html("<h2>Couldn't load. Please try again later.</h2>")
      }
    }

    // Read a page's GET URL variables and return them as an associative array.
    function getUrlVars()
    {
        var vars   = {};
        var hashes = window.location.href.slice(window.location.href.indexOf('?') + 1).split('&');
        for(var i = 0; i < hashes.length; i++)
        {
            hash          = hashes[i].split('=');
            vars[hash[0]] = unescape(hash[1]);
        }
        return vars;
    }

  </script>
  <style>
    body {
      margin: 0;
      padding: 0;
    }
    #wasabi_ensembl {
      height: 99vh;
    }
  </style>
</head>

<body>
  <div id="wasabi_ensembl"><div class="loading"><p class="spinner"></p></div></div>
</body>
</html>
